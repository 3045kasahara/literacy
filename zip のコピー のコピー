{"cells":[{"cell_type":"markdown","metadata":{"id":"ppNdnF-Xu8qX"},"source":["[矢吹太朗『Webのしくみ』（サイエンス社, 2020）](https://github.com/taroyabuki/webbook)\n","\n","下のアイコンをクリックすれば，この文書に掲載されているコードを，Google Colab上で実行できます．（Googleのアカウントが必要です．）\n","\n","[![Open In Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/github/taroyabuki/webbook/blob/master/chapters/10.4/zip.ipynb)"]},{"cell_type":"markdown","metadata":{"id":"FZZy6VirilZq"},"source":["# 郵便番号データベースによる体験SQL\n","\n","郵便番号データを使って，SQLでの検索を体験します．\n","\n","まずは準備です．\n","作成済みのデータベースを読み込んで，操作できるようにします．\n","この部分は，理解せずに実行するだけでかまいません．\n","（もちろん，理解しようとしてもかまいません．理解してもかまいません．）\n","\n","コードにカーソルを置いて，左側の▶ボタンをクリックするかShift+Enterで実行してください．"]},{"cell_type":"code","execution_count":1,"metadata":{"id":"7TxNa1w21LKW","executionInfo":{"status":"ok","timestamp":1719300094759,"user_tz":-540,"elapsed":1435,"user":{"displayName":"","userId":""}}},"outputs":[],"source":["# このセルは準備のためのものなので，理解できなくてかまいません．\n","!wget --quiet https://github.com/taroyabuki/webbook/raw/master/chapters/10.4/zip.sqlite3\n","import pandas as pd\n","import sqlite3\n","con = sqlite3.connect('zip.sqlite3')\n","def 実行(sql): return pd.read_sql_query(sql, con)"]},{"cell_type":"markdown","metadata":{"id":"oCBO5m4akAkL"},"source":["## 例1：全データ取得\n","\n","まずは，\n","\n","```\n","zipという表から，\n","すべての列を取り出す．\n","```\n","\n","という操作をしてみます．\n","次のように翻訳します．\n","\n","```\n","zipという表から， → from zip\n","すべての列を取り出す． → select *\n","```\n","\n","並び替えてSQL文とします．\n","\n","```\n","select *\n","from zip\n","```\n","\n","実行します．\n","\n","```\n","実行('''\n","SQL文\n","''')\n","```\n","\n","↑のように書くと，SQL文が実行されるようにしてあります．\n","ですから，ここで作ったSQL文は，次のように実行します．"]},{"cell_type":"code","execution_count":2,"metadata":{"id":"rczFji-RMpS7","executionInfo":{"status":"ok","timestamp":1719300811837,"user_tz":-540,"elapsed":867,"user":{"displayName":"","userId":""}},"outputId":"a631fb11-dbcb-4f7a-f8c6-66bb7fd914b5","colab":{"base_uri":"https://localhost:8080/","height":424}},"outputs":[{"output_type":"execute_result","data":{"text/plain":["           code address1  address2      address3 address4         office\n","0       0600000      北海道    札幌市中央区    以下に掲載がない場合                        \n","1       0640941      北海道    札幌市中央区           旭ケ丘                        \n","2       0600041      北海道    札幌市中央区           大通東                        \n","3       0600042      北海道    札幌市中央区   大通西（１〜１９丁目）                        \n","4       0640820      北海道    札幌市中央区  大通西（２０〜２８丁目）                        \n","...         ...      ...       ...           ...      ...            ...\n","147103  9010496      沖縄県   島尻郡八重瀬町           字富盛     ２６０８    陸上自衛隊　与座分屯地\n","147104  9010592      沖縄県   島尻郡八重瀬町          字具志頭      １番地  八重瀬町役場　具志頭出張所\n","147105  9060692      沖縄県   宮古郡多良間村           字仲筋     ９９−２         多良間村役場\n","147106  9071292      沖縄県   八重山郡竹富町           字小浜     ２９３０    株式会社　はいむるぶし\n","147107  9071892      沖縄県  八重山郡与那国町          字与那国      １２９         与那国町役場\n","\n","[147108 rows x 6 columns]"],"text/html":["\n","  <div id=\"df-9d28a41a-b4a0-4418-a93c-6f031cb086be\" class=\"colab-df-container\">\n","    <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>code</th>\n","      <th>address1</th>\n","      <th>address2</th>\n","      <th>address3</th>\n","      <th>address4</th>\n","      <th>office</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>0600000</td>\n","      <td>北海道</td>\n","      <td>札幌市中央区</td>\n","      <td>以下に掲載がない場合</td>\n","      <td></td>\n","      <td></td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>0640941</td>\n","      <td>北海道</td>\n","      <td>札幌市中央区</td>\n","      <td>旭ケ丘</td>\n","      <td></td>\n","      <td></td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>0600041</td>\n","      <td>北海道</td>\n","      <td>札幌市中央区</td>\n","      <td>大通東</td>\n","      <td></td>\n","      <td></td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>0600042</td>\n","      <td>北海道</td>\n","      <td>札幌市中央区</td>\n","      <td>大通西（１〜１９丁目）</td>\n","      <td></td>\n","      <td></td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>0640820</td>\n","      <td>北海道</td>\n","      <td>札幌市中央区</td>\n","      <td>大通西（２０〜２８丁目）</td>\n","      <td></td>\n","      <td></td>\n","    </tr>\n","    <tr>\n","      <th>...</th>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","    </tr>\n","    <tr>\n","      <th>147103</th>\n","      <td>9010496</td>\n","      <td>沖縄県</td>\n","      <td>島尻郡八重瀬町</td>\n","      <td>字富盛</td>\n","      <td>２６０８</td>\n","      <td>陸上自衛隊　与座分屯地</td>\n","    </tr>\n","    <tr>\n","      <th>147104</th>\n","      <td>9010592</td>\n","      <td>沖縄県</td>\n","      <td>島尻郡八重瀬町</td>\n","      <td>字具志頭</td>\n","      <td>１番地</td>\n","      <td>八重瀬町役場　具志頭出張所</td>\n","    </tr>\n","    <tr>\n","      <th>147105</th>\n","      <td>9060692</td>\n","      <td>沖縄県</td>\n","      <td>宮古郡多良間村</td>\n","      <td>字仲筋</td>\n","      <td>９９−２</td>\n","      <td>多良間村役場</td>\n","    </tr>\n","    <tr>\n","      <th>147106</th>\n","      <td>9071292</td>\n","      <td>沖縄県</td>\n","      <td>八重山郡竹富町</td>\n","      <td>字小浜</td>\n","      <td>２９３０</td>\n","      <td>株式会社　はいむるぶし</td>\n","    </tr>\n","    <tr>\n","      <th>147107</th>\n","      <td>9071892</td>\n","      <td>沖縄県</td>\n","      <td>八重山郡与那国町</td>\n","      <td>字与那国</td>\n","      <td>１２９</td>\n","      <td>与那国町役場</td>\n","    </tr>\n","  </tbody>\n","</table>\n","<p>147108 rows × 6 columns</p>\n","</div>\n","    <div class=\"colab-df-buttons\">\n","\n","  <div class=\"colab-df-container\">\n","    <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-9d28a41a-b4a0-4418-a93c-6f031cb086be')\"\n","            title=\"Convert this dataframe to an interactive table.\"\n","            style=\"display:none;\">\n","\n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\" viewBox=\"0 -960 960 960\">\n","    <path d=\"M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z\"/>\n","  </svg>\n","    </button>\n","\n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    .colab-df-buttons div {\n","      margin-bottom: 4px;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","    <script>\n","      const buttonEl =\n","        document.querySelector('#df-9d28a41a-b4a0-4418-a93c-6f031cb086be button.colab-df-convert');\n","      buttonEl.style.display =\n","        google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","      async function convertToInteractive(key) {\n","        const element = document.querySelector('#df-9d28a41a-b4a0-4418-a93c-6f031cb086be');\n","        const dataTable =\n","          await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                    [key], {});\n","        if (!dataTable) return;\n","\n","        const docLinkHtml = 'Like what you see? Visit the ' +\n","          '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","          + ' to learn more about interactive tables.';\n","        element.innerHTML = '';\n","        dataTable['output_type'] = 'display_data';\n","        await google.colab.output.renderOutput(dataTable, element);\n","        const docLink = document.createElement('div');\n","        docLink.innerHTML = docLinkHtml;\n","        element.appendChild(docLink);\n","      }\n","    </script>\n","  </div>\n","\n","\n","<div id=\"df-bdc03a01-7e0d-49c2-84f4-2a729d3fcfc0\">\n","  <button class=\"colab-df-quickchart\" onclick=\"quickchart('df-bdc03a01-7e0d-49c2-84f4-2a729d3fcfc0')\"\n","            title=\"Suggest charts\"\n","            style=\"display:none;\">\n","\n","<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","     width=\"24px\">\n","    <g>\n","        <path d=\"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z\"/>\n","    </g>\n","</svg>\n","  </button>\n","\n","<style>\n","  .colab-df-quickchart {\n","      --bg-color: #E8F0FE;\n","      --fill-color: #1967D2;\n","      --hover-bg-color: #E2EBFA;\n","      --hover-fill-color: #174EA6;\n","      --disabled-fill-color: #AAA;\n","      --disabled-bg-color: #DDD;\n","  }\n","\n","  [theme=dark] .colab-df-quickchart {\n","      --bg-color: #3B4455;\n","      --fill-color: #D2E3FC;\n","      --hover-bg-color: #434B5C;\n","      --hover-fill-color: #FFFFFF;\n","      --disabled-bg-color: #3B4455;\n","      --disabled-fill-color: #666;\n","  }\n","\n","  .colab-df-quickchart {\n","    background-color: var(--bg-color);\n","    border: none;\n","    border-radius: 50%;\n","    cursor: pointer;\n","    display: none;\n","    fill: var(--fill-color);\n","    height: 32px;\n","    padding: 0;\n","    width: 32px;\n","  }\n","\n","  .colab-df-quickchart:hover {\n","    background-color: var(--hover-bg-color);\n","    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);\n","    fill: var(--button-hover-fill-color);\n","  }\n","\n","  .colab-df-quickchart-complete:disabled,\n","  .colab-df-quickchart-complete:disabled:hover {\n","    background-color: var(--disabled-bg-color);\n","    fill: var(--disabled-fill-color);\n","    box-shadow: none;\n","  }\n","\n","  .colab-df-spinner {\n","    border: 2px solid var(--fill-color);\n","    border-color: transparent;\n","    border-bottom-color: var(--fill-color);\n","    animation:\n","      spin 1s steps(1) infinite;\n","  }\n","\n","  @keyframes spin {\n","    0% {\n","      border-color: transparent;\n","      border-bottom-color: var(--fill-color);\n","      border-left-color: var(--fill-color);\n","    }\n","    20% {\n","      border-color: transparent;\n","      border-left-color: var(--fill-color);\n","      border-top-color: var(--fill-color);\n","    }\n","    30% {\n","      border-color: transparent;\n","      border-left-color: var(--fill-color);\n","      border-top-color: var(--fill-color);\n","      border-right-color: var(--fill-color);\n","    }\n","    40% {\n","      border-color: transparent;\n","      border-right-color: var(--fill-color);\n","      border-top-color: var(--fill-color);\n","    }\n","    60% {\n","      border-color: transparent;\n","      border-right-color: var(--fill-color);\n","    }\n","    80% {\n","      border-color: transparent;\n","      border-right-color: var(--fill-color);\n","      border-bottom-color: var(--fill-color);\n","    }\n","    90% {\n","      border-color: transparent;\n","      border-bottom-color: var(--fill-color);\n","    }\n","  }\n","</style>\n","\n","  <script>\n","    async function quickchart(key) {\n","      const quickchartButtonEl =\n","        document.querySelector('#' + key + ' button');\n","      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.\n","      quickchartButtonEl.classList.add('colab-df-spinner');\n","      try {\n","        const charts = await google.colab.kernel.invokeFunction(\n","            'suggestCharts', [key], {});\n","      } catch (error) {\n","        console.error('Error during call to suggestCharts:', error);\n","      }\n","      quickchartButtonEl.classList.remove('colab-df-spinner');\n","      quickchartButtonEl.classList.add('colab-df-quickchart-complete');\n","    }\n","    (() => {\n","      let quickchartButtonEl =\n","        document.querySelector('#df-bdc03a01-7e0d-49c2-84f4-2a729d3fcfc0 button');\n","      quickchartButtonEl.style.display =\n","        google.colab.kernel.accessAllowed ? 'block' : 'none';\n","    })();\n","  </script>\n","</div>\n","\n","    </div>\n","  </div>\n"],"application/vnd.google.colaboratory.intrinsic+json":{"type":"dataframe"}},"metadata":{},"execution_count":2}],"source":["実行('''\n","select *\n","from zip\n","''')"]},{"cell_type":"markdown","metadata":{"id":"s_5j4aJmj6lV"},"source":["## 例2：件数\n","\n","`select count(*)`として，件数を得ます．補足：例1の結果にも表示されていますが，それはSQLではなくPythonによるものです．"]},{"cell_type":"code","execution_count":3,"metadata":{"id":"r5Q7tpKiM3kq","executionInfo":{"status":"ok","timestamp":1719300829424,"user_tz":-540,"elapsed":307,"user":{"displayName":"","userId":""}},"outputId":"28e401bf-2c51-4f8e-cd25-c1233f6c69da","colab":{"base_uri":"https://localhost:8080/","height":81}},"outputs":[{"output_type":"execute_result","data":{"text/plain":["   count(*)\n","0    147108"],"text/html":["\n","  <div id=\"df-1cfcf5be-ad86-4580-ab82-7f165c050217\" class=\"colab-df-container\">\n","    <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>count(*)</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>147108</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","    <div class=\"colab-df-buttons\">\n","\n","  <div class=\"colab-df-container\">\n","    <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-1cfcf5be-ad86-4580-ab82-7f165c050217')\"\n","            title=\"Convert this dataframe to an interactive table.\"\n","            style=\"display:none;\">\n","\n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\" viewBox=\"0 -960 960 960\">\n","    <path d=\"M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z\"/>\n","  </svg>\n","    </button>\n","\n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    .colab-df-buttons div {\n","      margin-bottom: 4px;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","    <script>\n","      const buttonEl =\n","        document.querySelector('#df-1cfcf5be-ad86-4580-ab82-7f165c050217 button.colab-df-convert');\n","      buttonEl.style.display =\n","        google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","      async function convertToInteractive(key) {\n","        const element = document.querySelector('#df-1cfcf5be-ad86-4580-ab82-7f165c050217');\n","        const dataTable =\n","          await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                    [key], {});\n","        if (!dataTable) return;\n","\n","        const docLinkHtml = 'Like what you see? Visit the ' +\n","          '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","          + ' to learn more about interactive tables.';\n","        element.innerHTML = '';\n","        dataTable['output_type'] = 'display_data';\n","        await google.colab.output.renderOutput(dataTable, element);\n","        const docLink = document.createElement('div');\n","        docLink.innerHTML = docLinkHtml;\n","        element.appendChild(docLink);\n","      }\n","    </script>\n","  </div>\n","\n","\n","    </div>\n","  </div>\n"],"application/vnd.google.colaboratory.intrinsic+json":{"type":"dataframe","summary":"{\n  \"name\": \"''')\",\n  \"rows\": 1,\n  \"fields\": [\n    {\n      \"column\": \"count(*)\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": null,\n        \"min\": 147108,\n        \"max\": 147108,\n        \"num_unique_values\": 1,\n        \"samples\": [\n          147108\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    }\n  ]\n}"}},"metadata":{},"execution_count":3}],"source":["実行('''\n","select count(*)\n","from zip\n","''')"]},{"cell_type":"markdown","metadata":{"id":"cf8DmjPokjx3"},"source":["## 例3：条件\n","\n","`where 条件`として，条件を設定します．\n","「where」は「場所」というよりは「場合」のことだと考えましょう．"]},{"cell_type":"markdown","metadata":{"id":"5LcFzetWmWSM"},"source":["### 例3.1：完全一致\n","\n","等号は`=`，等号否定は`!=`や`<>`です．"]},{"cell_type":"code","execution_count":4,"metadata":{"id":"kNooqDRkM_PK","executionInfo":{"status":"ok","timestamp":1719301048637,"user_tz":-540,"elapsed":298,"user":{"displayName":"","userId":""}},"outputId":"2dbbd8be-1196-4934-d438-c8f64f4dd331","colab":{"base_uri":"https://localhost:8080/","height":81}},"outputs":[{"output_type":"execute_result","data":{"text/plain":["      code address1 address2 address3 address4             office\n","0  2758588      千葉県     習志野市      津田沼  ２丁目１７−１  学校法人　千葉工業大学　津田沼校舎"],"text/html":["\n","  <div id=\"df-d79e06d1-d8b9-45a1-8b4f-6ec6e77f1635\" class=\"colab-df-container\">\n","    <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>code</th>\n","      <th>address1</th>\n","      <th>address2</th>\n","      <th>address3</th>\n","      <th>address4</th>\n","      <th>office</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>2758588</td>\n","      <td>千葉県</td>\n","      <td>習志野市</td>\n","      <td>津田沼</td>\n","      <td>２丁目１７−１</td>\n","      <td>学校法人　千葉工業大学　津田沼校舎</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","    <div class=\"colab-df-buttons\">\n","\n","  <div class=\"colab-df-container\">\n","    <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-d79e06d1-d8b9-45a1-8b4f-6ec6e77f1635')\"\n","            title=\"Convert this dataframe to an interactive table.\"\n","            style=\"display:none;\">\n","\n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\" viewBox=\"0 -960 960 960\">\n","    <path d=\"M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z\"/>\n","  </svg>\n","    </button>\n","\n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    .colab-df-buttons div {\n","      margin-bottom: 4px;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","    <script>\n","      const buttonEl =\n","        document.querySelector('#df-d79e06d1-d8b9-45a1-8b4f-6ec6e77f1635 button.colab-df-convert');\n","      buttonEl.style.display =\n","        google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","      async function convertToInteractive(key) {\n","        const element = document.querySelector('#df-d79e06d1-d8b9-45a1-8b4f-6ec6e77f1635');\n","        const dataTable =\n","          await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                    [key], {});\n","        if (!dataTable) return;\n","\n","        const docLinkHtml = 'Like what you see? Visit the ' +\n","          '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","          + ' to learn more about interactive tables.';\n","        element.innerHTML = '';\n","        dataTable['output_type'] = 'display_data';\n","        await google.colab.output.renderOutput(dataTable, element);\n","        const docLink = document.createElement('div');\n","        docLink.innerHTML = docLinkHtml;\n","        element.appendChild(docLink);\n","      }\n","    </script>\n","  </div>\n","\n","\n","    </div>\n","  </div>\n"],"application/vnd.google.colaboratory.intrinsic+json":{"type":"dataframe","summary":"{\n  \"name\": \"''')\",\n  \"rows\": 1,\n  \"fields\": [\n    {\n      \"column\": \"code\",\n      \"properties\": {\n        \"dtype\": \"string\",\n        \"num_unique_values\": 1,\n        \"samples\": [\n          \"2758588\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"address1\",\n      \"properties\": {\n        \"dtype\": \"string\",\n        \"num_unique_values\": 1,\n        \"samples\": [\n          \"\\u5343\\u8449\\u770c\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"address2\",\n      \"properties\": {\n        \"dtype\": \"string\",\n        \"num_unique_values\": 1,\n        \"samples\": [\n          \"\\u7fd2\\u5fd7\\u91ce\\u5e02\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"address3\",\n      \"properties\": {\n        \"dtype\": \"string\",\n        \"num_unique_values\": 1,\n        \"samples\": [\n          \"\\u6d25\\u7530\\u6cbc\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"address4\",\n      \"properties\": {\n        \"dtype\": \"string\",\n        \"num_unique_values\": 1,\n        \"samples\": [\n          \"\\uff12\\u4e01\\u76ee\\uff11\\uff17\\u2212\\uff11\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"office\",\n      \"properties\": {\n        \"dtype\": \"string\",\n        \"num_unique_values\": 1,\n        \"samples\": [\n          \"\\u5b66\\u6821\\u6cd5\\u4eba\\u3000\\u5343\\u8449\\u5de5\\u696d\\u5927\\u5b66\\u3000\\u6d25\\u7530\\u6cbc\\u6821\\u820e\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    }\n  ]\n}"}},"metadata":{},"execution_count":4}],"source":["実行('''\n","select *\n","from zip\n","where code = '2758588'\n","''')"]},{"cell_type":"markdown","metadata":{"id":"oPicOt2BmcNg"},"source":["### 例3.2 部分一致\n","\n","任意の文字列を「`%`」で表し，「`%`」を含む文字列との比較を`like`や`not like`で行います．\n","\n","27から始まる郵便番号を検索します．"]},{"cell_type":"code","execution_count":5,"metadata":{"id":"GPBEBMrvNMU7","executionInfo":{"status":"ok","timestamp":1719301058134,"user_tz":-540,"elapsed":302,"user":{"displayName":"","userId":""}},"outputId":"922208ba-cf33-4102-a47e-098d38a8ed08","colab":{"base_uri":"https://localhost:8080/","height":424}},"outputs":[{"output_type":"execute_result","data":{"text/plain":["         code address1 address2    address3 address4        office\n","0     2720000      千葉県      市川市  以下に掲載がない場合                       \n","1     2720143      千葉県      市川市         相之川                       \n","2     2720144      千葉県      市川市          新井                       \n","3     2720106      千葉県      市川市         伊勢宿                       \n","4     2720034      千葉県      市川市          市川                       \n","...       ...      ...      ...         ...      ...           ...\n","1177  2701493      千葉県      白井市          桜台     １丁目４       社会保険大学校\n","1178  2701492      千葉県      白井市           復     １１２３         白井市役所\n","1179  2701496      千葉県      白井市          桜台     １丁目２  信組情報サービス　（株）\n","1180  2701495      千葉県      白井市           中    ３０５−１     フクダ電子　（株）\n","1181  2701592      千葉県    印旛郡栄町         安食台    １丁目２番          栄町役場\n","\n","[1182 rows x 6 columns]"],"text/html":["\n","  <div id=\"df-20cb6d02-63f7-4ab7-b30b-883b12ee81b0\" class=\"colab-df-container\">\n","    <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>code</th>\n","      <th>address1</th>\n","      <th>address2</th>\n","      <th>address3</th>\n","      <th>address4</th>\n","      <th>office</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>2720000</td>\n","      <td>千葉県</td>\n","      <td>市川市</td>\n","      <td>以下に掲載がない場合</td>\n","      <td></td>\n","      <td></td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>2720143</td>\n","      <td>千葉県</td>\n","      <td>市川市</td>\n","      <td>相之川</td>\n","      <td></td>\n","      <td></td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>2720144</td>\n","      <td>千葉県</td>\n","      <td>市川市</td>\n","      <td>新井</td>\n","      <td></td>\n","      <td></td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>2720106</td>\n","      <td>千葉県</td>\n","      <td>市川市</td>\n","      <td>伊勢宿</td>\n","      <td></td>\n","      <td></td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>2720034</td>\n","      <td>千葉県</td>\n","      <td>市川市</td>\n","      <td>市川</td>\n","      <td></td>\n","      <td></td>\n","    </tr>\n","    <tr>\n","      <th>...</th>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","    </tr>\n","    <tr>\n","      <th>1177</th>\n","      <td>2701493</td>\n","      <td>千葉県</td>\n","      <td>白井市</td>\n","      <td>桜台</td>\n","      <td>１丁目４</td>\n","      <td>社会保険大学校</td>\n","    </tr>\n","    <tr>\n","      <th>1178</th>\n","      <td>2701492</td>\n","      <td>千葉県</td>\n","      <td>白井市</td>\n","      <td>復</td>\n","      <td>１１２３</td>\n","      <td>白井市役所</td>\n","    </tr>\n","    <tr>\n","      <th>1179</th>\n","      <td>2701496</td>\n","      <td>千葉県</td>\n","      <td>白井市</td>\n","      <td>桜台</td>\n","      <td>１丁目２</td>\n","      <td>信組情報サービス　（株）</td>\n","    </tr>\n","    <tr>\n","      <th>1180</th>\n","      <td>2701495</td>\n","      <td>千葉県</td>\n","      <td>白井市</td>\n","      <td>中</td>\n","      <td>３０５−１</td>\n","      <td>フクダ電子　（株）</td>\n","    </tr>\n","    <tr>\n","      <th>1181</th>\n","      <td>2701592</td>\n","      <td>千葉県</td>\n","      <td>印旛郡栄町</td>\n","      <td>安食台</td>\n","      <td>１丁目２番</td>\n","      <td>栄町役場</td>\n","    </tr>\n","  </tbody>\n","</table>\n","<p>1182 rows × 6 columns</p>\n","</div>\n","    <div class=\"colab-df-buttons\">\n","\n","  <div class=\"colab-df-container\">\n","    <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-20cb6d02-63f7-4ab7-b30b-883b12ee81b0')\"\n","            title=\"Convert this dataframe to an interactive table.\"\n","            style=\"display:none;\">\n","\n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\" viewBox=\"0 -960 960 960\">\n","    <path d=\"M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z\"/>\n","  </svg>\n","    </button>\n","\n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    .colab-df-buttons div {\n","      margin-bottom: 4px;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","    <script>\n","      const buttonEl =\n","        document.querySelector('#df-20cb6d02-63f7-4ab7-b30b-883b12ee81b0 button.colab-df-convert');\n","      buttonEl.style.display =\n","        google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","      async function convertToInteractive(key) {\n","        const element = document.querySelector('#df-20cb6d02-63f7-4ab7-b30b-883b12ee81b0');\n","        const dataTable =\n","          await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                    [key], {});\n","        if (!dataTable) return;\n","\n","        const docLinkHtml = 'Like what you see? Visit the ' +\n","          '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","          + ' to learn more about interactive tables.';\n","        element.innerHTML = '';\n","        dataTable['output_type'] = 'display_data';\n","        await google.colab.output.renderOutput(dataTable, element);\n","        const docLink = document.createElement('div');\n","        docLink.innerHTML = docLinkHtml;\n","        element.appendChild(docLink);\n","      }\n","    </script>\n","  </div>\n","\n","\n","<div id=\"df-b08dace8-ef0d-4374-8d6f-4f6d023401c4\">\n","  <button class=\"colab-df-quickchart\" onclick=\"quickchart('df-b08dace8-ef0d-4374-8d6f-4f6d023401c4')\"\n","            title=\"Suggest charts\"\n","            style=\"display:none;\">\n","\n","<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","     width=\"24px\">\n","    <g>\n","        <path d=\"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z\"/>\n","    </g>\n","</svg>\n","  </button>\n","\n","<style>\n","  .colab-df-quickchart {\n","      --bg-color: #E8F0FE;\n","      --fill-color: #1967D2;\n","      --hover-bg-color: #E2EBFA;\n","      --hover-fill-color: #174EA6;\n","      --disabled-fill-color: #AAA;\n","      --disabled-bg-color: #DDD;\n","  }\n","\n","  [theme=dark] .colab-df-quickchart {\n","      --bg-color: #3B4455;\n","      --fill-color: #D2E3FC;\n","      --hover-bg-color: #434B5C;\n","      --hover-fill-color: #FFFFFF;\n","      --disabled-bg-color: #3B4455;\n","      --disabled-fill-color: #666;\n","  }\n","\n","  .colab-df-quickchart {\n","    background-color: var(--bg-color);\n","    border: none;\n","    border-radius: 50%;\n","    cursor: pointer;\n","    display: none;\n","    fill: var(--fill-color);\n","    height: 32px;\n","    padding: 0;\n","    width: 32px;\n","  }\n","\n","  .colab-df-quickchart:hover {\n","    background-color: var(--hover-bg-color);\n","    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);\n","    fill: var(--button-hover-fill-color);\n","  }\n","\n","  .colab-df-quickchart-complete:disabled,\n","  .colab-df-quickchart-complete:disabled:hover {\n","    background-color: var(--disabled-bg-color);\n","    fill: var(--disabled-fill-color);\n","    box-shadow: none;\n","  }\n","\n","  .colab-df-spinner {\n","    border: 2px solid var(--fill-color);\n","    border-color: transparent;\n","    border-bottom-color: var(--fill-color);\n","    animation:\n","      spin 1s steps(1) infinite;\n","  }\n","\n","  @keyframes spin {\n","    0% {\n","      border-color: transparent;\n","      border-bottom-color: var(--fill-color);\n","      border-left-color: var(--fill-color);\n","    }\n","    20% {\n","      border-color: transparent;\n","      border-left-color: var(--fill-color);\n","      border-top-color: var(--fill-color);\n","    }\n","    30% {\n","      border-color: transparent;\n","      border-left-color: var(--fill-color);\n","      border-top-color: var(--fill-color);\n","      border-right-color: var(--fill-color);\n","    }\n","    40% {\n","      border-color: transparent;\n","      border-right-color: var(--fill-color);\n","      border-top-color: var(--fill-color);\n","    }\n","    60% {\n","      border-color: transparent;\n","      border-right-color: var(--fill-color);\n","    }\n","    80% {\n","      border-color: transparent;\n","      border-right-color: var(--fill-color);\n","      border-bottom-color: var(--fill-color);\n","    }\n","    90% {\n","      border-color: transparent;\n","      border-bottom-color: var(--fill-color);\n","    }\n","  }\n","</style>\n","\n","  <script>\n","    async function quickchart(key) {\n","      const quickchartButtonEl =\n","        document.querySelector('#' + key + ' button');\n","      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.\n","      quickchartButtonEl.classList.add('colab-df-spinner');\n","      try {\n","        const charts = await google.colab.kernel.invokeFunction(\n","            'suggestCharts', [key], {});\n","      } catch (error) {\n","        console.error('Error during call to suggestCharts:', error);\n","      }\n","      quickchartButtonEl.classList.remove('colab-df-spinner');\n","      quickchartButtonEl.classList.add('colab-df-quickchart-complete');\n","    }\n","    (() => {\n","      let quickchartButtonEl =\n","        document.querySelector('#df-b08dace8-ef0d-4374-8d6f-4f6d023401c4 button');\n","      quickchartButtonEl.style.display =\n","        google.colab.kernel.accessAllowed ? 'block' : 'none';\n","    })();\n","  </script>\n","</div>\n","\n","    </div>\n","  </div>\n"],"application/vnd.google.colaboratory.intrinsic+json":{"type":"dataframe","summary":"{\n  \"name\": \"''')\",\n  \"rows\": 1182,\n  \"fields\": [\n    {\n      \"column\": \"code\",\n      \"properties\": {\n        \"dtype\": \"string\",\n        \"num_unique_values\": 1176,\n        \"samples\": [\n          \"2730038\",\n          \"2760048\",\n          \"2730863\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"address1\",\n      \"properties\": {\n        \"dtype\": \"category\",\n        \"num_unique_values\": 1,\n        \"samples\": [\n          \"\\u5343\\u8449\\u770c\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"address2\",\n      \"properties\": {\n        \"dtype\": \"category\",\n        \"num_unique_values\": 14,\n        \"samples\": [\n          \"\\u938c\\u30b1\\u8c37\\u5e02\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"address3\",\n      \"properties\": {\n        \"dtype\": \"string\",\n        \"num_unique_values\": 846,\n        \"samples\": [\n          \"\\u9808\\u548c\\u7530\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"address4\",\n      \"properties\": {\n        \"dtype\": \"category\",\n        \"num_unique_values\": 236,\n        \"samples\": [\n          \"\\uff14\\u4e01\\u76ee\\uff11\\uff12\\u756a\\uff11\\u53f7\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"office\",\n      \"properties\": {\n        \"dtype\": \"category\",\n        \"num_unique_values\": 274,\n        \"samples\": [\n          \"\\u4f0a\\u85e4\\u30cf\\u30e0\\u30d5\\u30fc\\u30c9\\u30bd\\u30ea\\u30e5\\u30fc\\u30b7\\u30e7\\u30f3\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    }\n  ]\n}"}},"metadata":{},"execution_count":5}],"source":["実行('''\n","select *\n","from zip\n","where code like '27%'\n","''')"]},{"cell_type":"code","execution_count":6,"metadata":{"id":"q9AX0DN2qfgT","executionInfo":{"status":"ok","timestamp":1719301065186,"user_tz":-540,"elapsed":281,"user":{"displayName":"","userId":""}},"outputId":"bfa1d258-6cfa-4564-d2d8-1538d03dab11","colab":{"base_uri":"https://localhost:8080/","height":81}},"outputs":[{"output_type":"execute_result","data":{"text/plain":["   count(*)\n","0      1182"],"text/html":["\n","  <div id=\"df-8f04dcfa-b9f1-4103-a3fa-2eed32903ce3\" class=\"colab-df-container\">\n","    <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>count(*)</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>1182</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","    <div class=\"colab-df-buttons\">\n","\n","  <div class=\"colab-df-container\">\n","    <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-8f04dcfa-b9f1-4103-a3fa-2eed32903ce3')\"\n","            title=\"Convert this dataframe to an interactive table.\"\n","            style=\"display:none;\">\n","\n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\" viewBox=\"0 -960 960 960\">\n","    <path d=\"M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z\"/>\n","  </svg>\n","    </button>\n","\n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    .colab-df-buttons div {\n","      margin-bottom: 4px;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","    <script>\n","      const buttonEl =\n","        document.querySelector('#df-8f04dcfa-b9f1-4103-a3fa-2eed32903ce3 button.colab-df-convert');\n","      buttonEl.style.display =\n","        google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","      async function convertToInteractive(key) {\n","        const element = document.querySelector('#df-8f04dcfa-b9f1-4103-a3fa-2eed32903ce3');\n","        const dataTable =\n","          await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                    [key], {});\n","        if (!dataTable) return;\n","\n","        const docLinkHtml = 'Like what you see? Visit the ' +\n","          '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","          + ' to learn more about interactive tables.';\n","        element.innerHTML = '';\n","        dataTable['output_type'] = 'display_data';\n","        await google.colab.output.renderOutput(dataTable, element);\n","        const docLink = document.createElement('div');\n","        docLink.innerHTML = docLinkHtml;\n","        element.appendChild(docLink);\n","      }\n","    </script>\n","  </div>\n","\n","\n","    </div>\n","  </div>\n"],"application/vnd.google.colaboratory.intrinsic+json":{"type":"dataframe","summary":"{\n  \"name\": \"''')\",\n  \"rows\": 1,\n  \"fields\": [\n    {\n      \"column\": \"count(*)\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": null,\n        \"min\": 1182,\n        \"max\": 1182,\n        \"num_unique_values\": 1,\n        \"samples\": [\n          1182\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    }\n  ]\n}"}},"metadata":{},"execution_count":6}],"source":["実行('''\n","select count(*)\n","from zip\n","where code like '27%'\n","''')"]},{"cell_type":"markdown","metadata":{"id":"h0eQlPYImv2L"},"source":["### 例3.3 条件の組合せ\n","\n","条件を組み合わせるときは，`and`や`or`を使います．"]},{"cell_type":"code","execution_count":7,"metadata":{"id":"qC484HL7NdNS","executionInfo":{"status":"ok","timestamp":1719301070307,"user_tz":-540,"elapsed":289,"user":{"displayName":"","userId":""}},"outputId":"c682c852-2dc1-4721-9088-ffe10e409d09","colab":{"base_uri":"https://localhost:8080/","height":424}},"outputs":[{"output_type":"execute_result","data":{"text/plain":["        code address1 address2      address3       address4  \\\n","0    0600000      北海道   札幌市中央区    以下に掲載がない場合                  \n","1    0640941      北海道   札幌市中央区           旭ケ丘                  \n","2    0600041      北海道   札幌市中央区           大通東                  \n","3    0600042      北海道   札幌市中央区   大通西（１〜１９丁目）                  \n","4    0640820      北海道   札幌市中央区  大通西（２０〜２８丁目）                  \n","..       ...      ...      ...           ...            ...   \n","294  0648512      北海道   札幌市中央区          南一条西       ２５丁目１番１号   \n","295  0648543      北海道   札幌市中央区          南十条西       １丁目１番５０号   \n","296  0648522      北海道   札幌市中央区        南二十二条西  ９丁目アートパレスビル３Ｆ   \n","297  0648510      北海道   札幌市中央区        南二十六条西           １０丁目   \n","298  0648546      北海道   札幌市中央区          南九条西           １４丁目   \n","\n","                  office  \n","0                         \n","1                         \n","2                         \n","3                         \n","4                         \n","..                   ...  \n","294       三井道路　（株）　北海道支社  \n","295        ヤマハ　（株）　北海道支店  \n","296  （有）　日本書道評論社　北海道書道協会  \n","297        陸上自衛隊　北部方面総監部  \n","298    ロッテ商事　（株）　北海道統轄支店  \n","\n","[299 rows x 6 columns]"],"text/html":["\n","  <div id=\"df-9887712d-bbb5-4335-af32-620bf5b19835\" class=\"colab-df-container\">\n","    <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>code</th>\n","      <th>address1</th>\n","      <th>address2</th>\n","      <th>address3</th>\n","      <th>address4</th>\n","      <th>office</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>0600000</td>\n","      <td>北海道</td>\n","      <td>札幌市中央区</td>\n","      <td>以下に掲載がない場合</td>\n","      <td></td>\n","      <td></td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>0640941</td>\n","      <td>北海道</td>\n","      <td>札幌市中央区</td>\n","      <td>旭ケ丘</td>\n","      <td></td>\n","      <td></td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>0600041</td>\n","      <td>北海道</td>\n","      <td>札幌市中央区</td>\n","      <td>大通東</td>\n","      <td></td>\n","      <td></td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>0600042</td>\n","      <td>北海道</td>\n","      <td>札幌市中央区</td>\n","      <td>大通西（１〜１９丁目）</td>\n","      <td></td>\n","      <td></td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>0640820</td>\n","      <td>北海道</td>\n","      <td>札幌市中央区</td>\n","      <td>大通西（２０〜２８丁目）</td>\n","      <td></td>\n","      <td></td>\n","    </tr>\n","    <tr>\n","      <th>...</th>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","    </tr>\n","    <tr>\n","      <th>294</th>\n","      <td>0648512</td>\n","      <td>北海道</td>\n","      <td>札幌市中央区</td>\n","      <td>南一条西</td>\n","      <td>２５丁目１番１号</td>\n","      <td>三井道路　（株）　北海道支社</td>\n","    </tr>\n","    <tr>\n","      <th>295</th>\n","      <td>0648543</td>\n","      <td>北海道</td>\n","      <td>札幌市中央区</td>\n","      <td>南十条西</td>\n","      <td>１丁目１番５０号</td>\n","      <td>ヤマハ　（株）　北海道支店</td>\n","    </tr>\n","    <tr>\n","      <th>296</th>\n","      <td>0648522</td>\n","      <td>北海道</td>\n","      <td>札幌市中央区</td>\n","      <td>南二十二条西</td>\n","      <td>９丁目アートパレスビル３Ｆ</td>\n","      <td>（有）　日本書道評論社　北海道書道協会</td>\n","    </tr>\n","    <tr>\n","      <th>297</th>\n","      <td>0648510</td>\n","      <td>北海道</td>\n","      <td>札幌市中央区</td>\n","      <td>南二十六条西</td>\n","      <td>１０丁目</td>\n","      <td>陸上自衛隊　北部方面総監部</td>\n","    </tr>\n","    <tr>\n","      <th>298</th>\n","      <td>0648546</td>\n","      <td>北海道</td>\n","      <td>札幌市中央区</td>\n","      <td>南九条西</td>\n","      <td>１４丁目</td>\n","      <td>ロッテ商事　（株）　北海道統轄支店</td>\n","    </tr>\n","  </tbody>\n","</table>\n","<p>299 rows × 6 columns</p>\n","</div>\n","    <div class=\"colab-df-buttons\">\n","\n","  <div class=\"colab-df-container\">\n","    <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-9887712d-bbb5-4335-af32-620bf5b19835')\"\n","            title=\"Convert this dataframe to an interactive table.\"\n","            style=\"display:none;\">\n","\n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\" viewBox=\"0 -960 960 960\">\n","    <path d=\"M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z\"/>\n","  </svg>\n","    </button>\n","\n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    .colab-df-buttons div {\n","      margin-bottom: 4px;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","    <script>\n","      const buttonEl =\n","        document.querySelector('#df-9887712d-bbb5-4335-af32-620bf5b19835 button.colab-df-convert');\n","      buttonEl.style.display =\n","        google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","      async function convertToInteractive(key) {\n","        const element = document.querySelector('#df-9887712d-bbb5-4335-af32-620bf5b19835');\n","        const dataTable =\n","          await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                    [key], {});\n","        if (!dataTable) return;\n","\n","        const docLinkHtml = 'Like what you see? Visit the ' +\n","          '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","          + ' to learn more about interactive tables.';\n","        element.innerHTML = '';\n","        dataTable['output_type'] = 'display_data';\n","        await google.colab.output.renderOutput(dataTable, element);\n","        const docLink = document.createElement('div');\n","        docLink.innerHTML = docLinkHtml;\n","        element.appendChild(docLink);\n","      }\n","    </script>\n","  </div>\n","\n","\n","<div id=\"df-39b57c04-4d72-443d-913f-b77ada0ef68e\">\n","  <button class=\"colab-df-quickchart\" onclick=\"quickchart('df-39b57c04-4d72-443d-913f-b77ada0ef68e')\"\n","            title=\"Suggest charts\"\n","            style=\"display:none;\">\n","\n","<svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","     width=\"24px\">\n","    <g>\n","        <path d=\"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z\"/>\n","    </g>\n","</svg>\n","  </button>\n","\n","<style>\n","  .colab-df-quickchart {\n","      --bg-color: #E8F0FE;\n","      --fill-color: #1967D2;\n","      --hover-bg-color: #E2EBFA;\n","      --hover-fill-color: #174EA6;\n","      --disabled-fill-color: #AAA;\n","      --disabled-bg-color: #DDD;\n","  }\n","\n","  [theme=dark] .colab-df-quickchart {\n","      --bg-color: #3B4455;\n","      --fill-color: #D2E3FC;\n","      --hover-bg-color: #434B5C;\n","      --hover-fill-color: #FFFFFF;\n","      --disabled-bg-color: #3B4455;\n","      --disabled-fill-color: #666;\n","  }\n","\n","  .colab-df-quickchart {\n","    background-color: var(--bg-color);\n","    border: none;\n","    border-radius: 50%;\n","    cursor: pointer;\n","    display: none;\n","    fill: var(--fill-color);\n","    height: 32px;\n","    padding: 0;\n","    width: 32px;\n","  }\n","\n","  .colab-df-quickchart:hover {\n","    background-color: var(--hover-bg-color);\n","    box-shadow: 0 1px 2px rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);\n","    fill: var(--button-hover-fill-color);\n","  }\n","\n","  .colab-df-quickchart-complete:disabled,\n","  .colab-df-quickchart-complete:disabled:hover {\n","    background-color: var(--disabled-bg-color);\n","    fill: var(--disabled-fill-color);\n","    box-shadow: none;\n","  }\n","\n","  .colab-df-spinner {\n","    border: 2px solid var(--fill-color);\n","    border-color: transparent;\n","    border-bottom-color: var(--fill-color);\n","    animation:\n","      spin 1s steps(1) infinite;\n","  }\n","\n","  @keyframes spin {\n","    0% {\n","      border-color: transparent;\n","      border-bottom-color: var(--fill-color);\n","      border-left-color: var(--fill-color);\n","    }\n","    20% {\n","      border-color: transparent;\n","      border-left-color: var(--fill-color);\n","      border-top-color: var(--fill-color);\n","    }\n","    30% {\n","      border-color: transparent;\n","      border-left-color: var(--fill-color);\n","      border-top-color: var(--fill-color);\n","      border-right-color: var(--fill-color);\n","    }\n","    40% {\n","      border-color: transparent;\n","      border-right-color: var(--fill-color);\n","      border-top-color: var(--fill-color);\n","    }\n","    60% {\n","      border-color: transparent;\n","      border-right-color: var(--fill-color);\n","    }\n","    80% {\n","      border-color: transparent;\n","      border-right-color: var(--fill-color);\n","      border-bottom-color: var(--fill-color);\n","    }\n","    90% {\n","      border-color: transparent;\n","      border-bottom-color: var(--fill-color);\n","    }\n","  }\n","</style>\n","\n","  <script>\n","    async function quickchart(key) {\n","      const quickchartButtonEl =\n","        document.querySelector('#' + key + ' button');\n","      quickchartButtonEl.disabled = true;  // To prevent multiple clicks.\n","      quickchartButtonEl.classList.add('colab-df-spinner');\n","      try {\n","        const charts = await google.colab.kernel.invokeFunction(\n","            'suggestCharts', [key], {});\n","      } catch (error) {\n","        console.error('Error during call to suggestCharts:', error);\n","      }\n","      quickchartButtonEl.classList.remove('colab-df-spinner');\n","      quickchartButtonEl.classList.add('colab-df-quickchart-complete');\n","    }\n","    (() => {\n","      let quickchartButtonEl =\n","        document.querySelector('#df-39b57c04-4d72-443d-913f-b77ada0ef68e button');\n","      quickchartButtonEl.style.display =\n","        google.colab.kernel.accessAllowed ? 'block' : 'none';\n","    })();\n","  </script>\n","</div>\n","\n","    </div>\n","  </div>\n"],"application/vnd.google.colaboratory.intrinsic+json":{"type":"dataframe","summary":"{\n  \"name\": \"''')\",\n  \"rows\": 299,\n  \"fields\": [\n    {\n      \"column\": \"code\",\n      \"properties\": {\n        \"dtype\": \"string\",\n        \"num_unique_values\": 290,\n        \"samples\": [\n          \"0640958\",\n          \"0648533\",\n          \"0640801\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"address1\",\n      \"properties\": {\n        \"dtype\": \"category\",\n        \"num_unique_values\": 1,\n        \"samples\": [\n          \"\\u5317\\u6d77\\u9053\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"address2\",\n      \"properties\": {\n        \"dtype\": \"category\",\n        \"num_unique_values\": 1,\n        \"samples\": [\n          \"\\u672d\\u5e4c\\u5e02\\u4e2d\\u592e\\u533a\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"address3\",\n      \"properties\": {\n        \"dtype\": \"category\",\n        \"num_unique_values\": 102,\n        \"samples\": [\n          \"\\u5317\\u5341\\u4e94\\u6761\\u897f\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"address4\",\n      \"properties\": {\n        \"dtype\": \"string\",\n        \"num_unique_values\": 180,\n        \"samples\": [\n          \"\\uff15\\u4e01\\u76ee\\u30e1\\u30be\\u30f3\\u672c\\u5e9c\\uff17\\uff10\\uff11\\u53f7\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    },\n    {\n      \"column\": \"office\",\n      \"properties\": {\n        \"dtype\": \"string\",\n        \"num_unique_values\": 208,\n        \"samples\": [\n          \"\\uff08\\u682a\\uff09\\u3000\\u65e5\\u672c\\u5546\\u5de5\\u632f\\u8208\\u4f1a\"\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    }\n  ]\n}"}},"metadata":{},"execution_count":7}],"source":["実行('''\n","select *\n","from zip\n","where address1 = '北海道' and address2 like '%中央区%'\n","''')"]},{"cell_type":"markdown","metadata":{"id":"USBpBduvnurB"},"source":["### 練習\n","\n","officeに「千葉工」を含むデータの件数を求めてみましょう．"]},{"cell_type":"code","execution_count":10,"metadata":{"id":"nFo8eRFzR_Ez","executionInfo":{"status":"ok","timestamp":1719301227867,"user_tz":-540,"elapsed":284,"user":{"displayName":"","userId":""}},"outputId":"bdd7312a-09ab-4e41-c20d-11f6dc0c0bd6","colab":{"base_uri":"https://localhost:8080/","height":81}},"outputs":[{"output_type":"execute_result","data":{"text/plain":["   count(*)\n","0        18"],"text/html":["\n","  <div id=\"df-6c444dac-a700-4272-ac8b-1eac4784a815\" class=\"colab-df-container\">\n","    <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>count(*)</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>18</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","    <div class=\"colab-df-buttons\">\n","\n","  <div class=\"colab-df-container\">\n","    <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-6c444dac-a700-4272-ac8b-1eac4784a815')\"\n","            title=\"Convert this dataframe to an interactive table.\"\n","            style=\"display:none;\">\n","\n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\" viewBox=\"0 -960 960 960\">\n","    <path d=\"M120-120v-720h720v720H120Zm60-500h600v-160H180v160Zm220 220h160v-160H400v160Zm0 220h160v-160H400v160ZM180-400h160v-160H180v160Zm440 0h160v-160H620v160ZM180-180h160v-160H180v160Zm440 0h160v-160H620v160Z\"/>\n","  </svg>\n","    </button>\n","\n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    .colab-df-buttons div {\n","      margin-bottom: 4px;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","    <script>\n","      const buttonEl =\n","        document.querySelector('#df-6c444dac-a700-4272-ac8b-1eac4784a815 button.colab-df-convert');\n","      buttonEl.style.display =\n","        google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","      async function convertToInteractive(key) {\n","        const element = document.querySelector('#df-6c444dac-a700-4272-ac8b-1eac4784a815');\n","        const dataTable =\n","          await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                    [key], {});\n","        if (!dataTable) return;\n","\n","        const docLinkHtml = 'Like what you see? Visit the ' +\n","          '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","          + ' to learn more about interactive tables.';\n","        element.innerHTML = '';\n","        dataTable['output_type'] = 'display_data';\n","        await google.colab.output.renderOutput(dataTable, element);\n","        const docLink = document.createElement('div');\n","        docLink.innerHTML = docLinkHtml;\n","        element.appendChild(docLink);\n","      }\n","    </script>\n","  </div>\n","\n","\n","    </div>\n","  </div>\n"],"application/vnd.google.colaboratory.intrinsic+json":{"type":"dataframe","summary":"{\n  \"name\": \"''')\",\n  \"rows\": 1,\n  \"fields\": [\n    {\n      \"column\": \"count(*)\",\n      \"properties\": {\n        \"dtype\": \"number\",\n        \"std\": null,\n        \"min\": 18,\n        \"max\": 18,\n        \"num_unique_values\": 1,\n        \"samples\": [\n          18\n        ],\n        \"semantic_type\": \"\",\n        \"description\": \"\"\n      }\n    }\n  ]\n}"}},"metadata":{},"execution_count":10}],"source":["# ここにコードを書いて，実行して試してみてください．（いろいろ試したい場合は，左上の「＋ コード」をクリックして，セルを追加するといいでしょう．）\n","実行('''\n","select count(*)\n","from zip\n","where office like '%千葉工%'\n","''')"]},{"cell_type":"markdown","metadata":{"id":"_xZ6wwXRxIgN"},"source":["# 補足：Pythonだけで完結させる（やらなくていいです）\n","\n","Pythonは基本的には手続き型のプログラミング言語ですが，表形式のデータを宣言的に扱うしくみが用意されています．"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"tEf7OHu54UmR"},"outputs":[],"source":["# 準備\n","import pandas as pd\n","data = pd.read_csv('https://github.com/taroyabuki/webbook/raw/master/chapters/10.4/zip.csv',\n","                   converters={0:str},    # 0列目は文字列\n","                   keep_default_na=False) # 空白をNaNにしない"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"AisqXGizocSs"},"outputs":[],"source":["# 全データ\n","data"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"4q3cSdspceA0"},"outputs":[],"source":["# 完全一致\n","data.query(\"code == '2758588'\")"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"6zmQr5tIzNu8"},"outputs":[],"source":["# 部分一致（27で始まる郵便番号）\n","# startswithをcontainsにすると「・・・を含む」になる．\n","# startswithをendswithにすると「・・・で終わる」になる．\n","data.query(\"code.str.startswith('27')\", engine='python')"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"Zn5NsaP4LWbN"},"outputs":[],"source":["# 条件の組合せ\n","data.query(\"address1 == '北海道' and address2.str.contains('中央区')\", engine='python')"]},{"cell_type":"markdown","metadata":{"id":"eKx6SsmEpnYN"},"source":["### 練習\n","\n","officeに「千葉工」を含むデータの件数を求めてみましょう．"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"6bUVDOWoSSo0"},"outputs":[],"source":["# ここにコードを書いて，実行して試してみてください．（いろいろ試したい場合は，左上の「＋ コード」をクリックして，セルを追加するといいでしょう．）"]},{"cell_type":"markdown","metadata":{"id":"XGPgtb8dPrmB"},"source":["# 補足：シェルだけで完結させる（やらなくていいです）\n","\n","ここでやっている程度の話は，Pythonのような汎用プログラミング言語を持ち出すまでもなく，シェルスクリプトという簡易的なプログラムでも解決できます．\n","\n","参考書\n","\n","- [カーニハン，パイク『UNIXプログラミング環境』](https://calil.jp/search?q=UNIX%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0%E7%92%B0%E5%A2%83)（1985年版と2017年版のどちらを参照してもかまいません．）\n","- [エイホほか『プログラミング言語AWK』](https://calil.jp/search?q=%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0%E8%A8%80%E8%AA%9EAWK)（第1版と第2版のどちらを参照してもかまいません．）\n","\n","以下，「`-F,`」は「コンマで分割する」という意味です．"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"99KvQN7qscjX"},"outputs":[],"source":["# ツールのインストール（管理者権限が必要）\n","!apt-get install gawk | tail -n 1"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"jaunZim0P1NN"},"outputs":[],"source":["# 準備\n","!wget --quiet https://github.com/taroyabuki/webbook/raw/master/chapters/10.4/zip.csv"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"K8mABv21pw8A"},"outputs":[],"source":["# データの形式\n","!head zip.csv"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"o4w34WouP5IQ"},"outputs":[],"source":["# 件数（この結果から見出しの分つまり1を引く）\n","!wc -l zip.csv"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"K4PUSYWLePma"},"outputs":[],"source":["# 完全一致\n","!awk -F, '$1==\"\\\"2758588\\\"\"' zip.csv"]},{"cell_type":"code","source":["# 部分一致（27で始まる郵便番号．headを付けて最初の方を表示する．）\n","!awk -F, '$1~/\"27/' zip.csv | head"],"metadata":{"id":"2hQ_RGNLtTh4"},"execution_count":null,"outputs":[]},{"cell_type":"code","execution_count":null,"metadata":{"id":"HAweDM06c1qk"},"outputs":[],"source":["# 部分一致（「 | wc -l」を付けて件数を数える．）\n","!awk -F, '$1~/\"27/' zip.csv | wc -l"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"CfrzW-MMdJZ3"},"outputs":[],"source":["# 条件の組合せ\n","!awk -F, '$2==\"\\\"北海道\\\"\" && $3~/中央区/' zip.csv | head"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"wV6bXq6Kreaq"},"outputs":[],"source":["!awk -F, '$2==\"\\\"北海道\\\"\" && $3~/中央区/' zip.csv | wc -l"]},{"cell_type":"markdown","metadata":{"id":"1185FTn7rj3J"},"source":["### 練習\n","\n","officeに「千葉工」を含むデータの件数を求めてみましょう．"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"m8MqtdR9SU9q"},"outputs":[],"source":["# ここにコードを書いて，実行して試してみてください．（いろいろ試したい場合は，左上の「＋ コード」をクリックして，セルを追加するといいでしょう．）\n"]},{"cell_type":"markdown","metadata":{"id":"zJjltowexneN"},"source":["# （気が強い人のための）補足：データベースの作り方\n","\n","**最新版のデータを使うため，上に掲載したのとは，違う結果を得る可能性があります．**\n","\n","日本の郵便番号のデータは，https://www.post.japanpost.jp/zipcode/download.html で，CSV形式で公開されています．\n","このデータをダウンロードして，データベースを作ります．\n","\n","SQLite3というデータベース管理システムを使います．\n","SQLite3の操作はPythonで行います．"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"iWU5VpCFscjZ"},"outputs":[],"source":["# ツールのインストール（管理者権限が必要）\n","!apt-get install nkf gawk -y | tail -n 1"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"lItTaYnW3cyA"},"outputs":[],"source":["# 準備\n","!rm -f *.zip *.csv *.CSV # 作業ファイルの削除\n","\n","# ダウンロード\n","!wget --quiet https://www.post.japanpost.jp/zipcode/dl/kogaki/zip/ken_all.zip\n","!wget --quiet https://www.post.japanpost.jp/zipcode/dl/jigyosyo/zip/jigyosyo.zip\n","\n","# 展開\n","!unzip -q ken_all.zip\n","!unzip -q jigyosyo.zip\n","\n","# zip.csvの作成\n","!echo 'code,address1,address2,address3,address4,office' > zip.csv\n","\n","# 文字コードの変換と必要なデータの抽出\n","!nkf -Lu -w KEN_ALL.CSV | gawk -F, -v OFS=\",\" '{print $3,$7,$8,$9,\"\\\"\\\"\",\"\\\"\\\"\"}'  >> zip.csv\n","!nkf -Lu -w JIGYOSYO.CSV | gawk -F, -v OFS=\",\" '{print $8,$4,$5,$6,$7,$3}' >> zip.csv"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"zQ0NeSAR81cN"},"outputs":[],"source":["# 元のデータはこんな感じ（nkf -wでUTF-8に変換してから，headで先頭部分を表示）\n","!nkf -w KEN_ALL.CSV | head"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"YL5osQxDzTe9"},"outputs":[],"source":["# 抽出後のデータはこんな感じ\n","!head zip.csv"]},{"cell_type":"code","source":["# データの件数\n","!wc -l zip.csv"],"metadata":{"id":"DHwQik9YdgKA"},"execution_count":null,"outputs":[]},{"cell_type":"markdown","metadata":{"id":"_h7IXXJp2TeE"},"source":["一度Pythonで読み込んで，SQLiteのデータベースにデータを挿入する．（zip.sqlite3というファイルができる．これが，作りたかったものである．）"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"goFpFxeI3lK8"},"outputs":[],"source":["# Pythonで読み込む\n","import pandas as pd\n","data = pd.read_csv('zip.csv', converters={0:str}, keep_default_na=False)\n","\n","import sqlite3\n","!rm -f zip.sqlite3                   # 既存のデータベースの削除\n","con = sqlite3.connect('zip.sqlite3') # データベースの作成\n","data.to_sql('zip', con, index=False) # データの挿入\n","cur = con.cursor()                   # インデックスの作成（番号での検索を高速化するため）\n","cur.execute('create index code_idx on zip (code)')"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"H87iduIY44kQ"},"outputs":[],"source":["# 動作確認2\n","pd.read_sql_query('select * from zip limit 10', con)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"8a5hDFjq463Y"},"outputs":[],"source":["# データベースを閉じて終了\n","con.close()"]}],"metadata":{"colab":{"name":"zip のコピー","provenance":[{"file_id":"https://github.com/taroyabuki/webbook/blob/master/chapters/10.4/zip.ipynb","timestamp":1719301353271}],"toc_visible":true},"kernelspec":{"display_name":"Python 3","language":"python","name":"python3"},"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.8.8"}},"nbformat":4,"nbformat_minor":0}